local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local Lighting = game:GetService("Lighting")

local LocalPlayer = Players.LocalPlayer
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")

if PlayerGui:FindFirstChild("TanqrScriptGUI") then
    PlayerGui.TanqrScriptGUI:Destroy()
end

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "TanqrScriptGUI"
ScreenGui.Parent = PlayerGui
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
ScreenGui.ResetOnSpawn = false

local function addCorner(o,r)
    local c = Instance.new("UICorner")
    c.CornerRadius = UDim.new(0,r)
    c.Parent = o
end

local function addStroke(o,t,col)
    local s = Instance.new("UIStroke")
    s.Thickness = t
    s.Color = col
    s.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
    s.Parent = o
end

local function makeDraggable(f)
    local d,i,sp,sfp
    f.InputBegan:Connect(function(inp)
        if inp.UserInputType == Enum.UserInputType.MouseButton1 or inp.UserInputType == Enum.UserInputType.Touch then
            d = true
            sp = inp.Position
            sfp = f.Position
            inp.Changed:Connect(function()
                if inp.UserInputState == Enum.UserInputState.End then d = false end
            end)
        end
    end)
    f.InputChanged:Connect(function(inp)
        if inp.UserInputType == Enum.UserInputType.MouseMovement or inp.UserInputType == Enum.UserInputType.Touch then
            i = inp
        end
    end)
    UserInputService.InputChanged:Connect(function(inp)
        if inp == i and d then
            local delta = inp.Position - sp
            f.Position = UDim2.new(sfp.X.Scale,sfp.X.Offset+delta.X,sfp.Y.Scale,sfp.Y.Offset+delta.Y)
        end
    end)
end

local function createFrame(n,p,s,pos,v)
    local f = Instance.new("Frame")
    f.Name = n
    f.Parent = p
    f.Size = s
    f.Position = pos
    f.Visible = v
    f.BackgroundColor3 = Color3.fromRGB(18,18,18)
    f.Active = true
    addCorner(f,12)
    addStroke(f,2,Color3.fromRGB(85,255,255))
    makeDraggable(f)
    return f
end

local function btn(n,p,s,pos,t)
    local b = Instance.new("TextButton")
    b.Name = n
    b.Parent = p
    b.Size = s
    b.Position = pos
    b.Text = t
    b.Font = Enum.Font.Bangers
    b.TextScaled = true
    b.TextColor3 = Color3.fromRGB(85,255,255)
    b.BackgroundColor3 = Color3.fromRGB(10,10,10)
    b.AutoButtonColor = false
    addCorner(b,10)
    addStroke(b,2,Color3.fromRGB(85,255,255))
    return b
end

local function lbl(n,p,s,pos,t)
    local l = Instance.new("TextLabel")
    l.Name = n
    l.Parent = p
    l.Size = s
    l.Position = pos
    l.Text = t
    l.Font = Enum.Font.Bangers
    l.TextScaled = true
    l.TextColor3 = Color3.fromRGB(85,255,255)
    l.BackgroundColor3 = Color3.fromRGB(0,0,0)
    l.BackgroundTransparency = 0.3
    addCorner(l,8)
    addStroke(l,1.5,Color3.fromRGB(85,255,255))
    return l
end

local OpenButton = btn("OpenButton",ScreenGui,UDim2.new(0,100,0,40),UDim2.new(0,10,0,10),"OPEN")
OpenButton.Visible = false

local Main = createFrame("Main",ScreenGui,UDim2.new(0,400,0,300),UDim2.new(0.06,0,0.1,0),true)
lbl("Title",Main,UDim2.new(0,380,0,50),UDim2.new(0,10,0,10),"Tanqr Script")

local TanqrAimBtn = btn("TanqrAimBtn",Main,UDim2.new(0,180,0,50),UDim2.new(0.05,0,0.25,0),"Tanqr Aim: OFF")
local PurpleTeamBtn = btn("PurpleTeamBtn",Main,UDim2.new(0,180,0,50),UDim2.new(0.55,0,0.25,0),"Purple Team")
local SettingsBtn = btn("SettingsBtn",Main,UDim2.new(0,180,0,50),UDim2.new(0.05,0,0.45,0),"Settings")
local AntiLagBtn = btn("AntiLagBtn",Main,UDim2.new(0,180,0,50),UDim2.new(0.55,0,0.45,0),"Anti Lag: OFF")

lbl("Footer",Main,UDim2.new(0,380,0,40),UDim2.new(0,10,0.86,0),"Made BY Golden blue on github")

local CloseMain = btn("CloseMain",Main,UDim2.new(0,30,0,30),UDim2.new(0.9,0,0.02,0),"X")
CloseMain.BackgroundColor3 = Color3.fromRGB(120,0,0)

local Settings = createFrame("Settings",ScreenGui,UDim2.new(0,400,0,300),UDim2.new(0.06,0,0.1,0),false)
lbl("SettingsTitle",Settings,UDim2.new(0,380,0,50),UDim2.new(0,10,0,10),"Settings")

local ShadersBtn = btn("ShadersBtn",Settings,UDim2.new(0,180,0,50),UDim2.new(0.05,0,0.25,0),"Shaders: OFF")
local ESPBtn = btn("ESPBtn",Settings,UDim2.new(0,180,0,50),UDim2.new(0.55,0,0.25,0),"ESP Name: OFF")
local DayNightBtn = btn("DayNightBtn",Settings,UDim2.new(0,180,0,50),UDim2.new(0.05,0,0.45,0),"Night Mode")

local CloseSettings = btn("CloseSettings",Settings,UDim2.new(0,30,0,30),UDim2.new(0.9,0,0.02,0),"X")
CloseSettings.BackgroundColor3 = Color3.fromRGB(120,0,0)

local AimEnabled = false
local ESPEnabled = false
local NightMode = false

local AimParts = {
    HeadHB = Vector3.new(20,20,20),
    HumanoidRootPart = Vector3.new(16,16,16),
    RightUpperLeg = Vector3.new(14,14,14),
    LeftUpperLeg = Vector3.new(14,14,14)
}


local OriginalParts = {}

local function restoreParts()
    for part,data in pairs(OriginalParts) do
        if part and part.Parent then
            part.Size = data.Size
            part.Transparency = data.Transparency
            part.CanCollide = data.CanCollide
            part.LocalTransparencyModifier = data.LTM or 0
            part.CastShadow = true
        end
    end
    table.clear(OriginalParts)
end

task.spawn(function()
    while task.wait(0.25) do
        if not AimEnabled then continue end
        for _,plr in ipairs(Players:GetPlayers()) do
            if plr ~= LocalPlayer and plr.Character then
                for n,s in pairs(AimParts) do
                    local part = plr.Character:FindFirstChild(n)
                    if part then
                        if not OriginalParts[part] then
                            OriginalParts[part] = {
                                Size = part.Size,
                                Transparency = part.Transparency,
                                CanCollide = part.CanCollide,
                                LTM = part.LocalTransparencyModifier
                            }
                        end
                        part.Size = s
                        part.Transparency = 0
                        part.LocalTransparencyModifier = 1
                        part.CanCollide = false
                        part.CastShadow = false
                        part.Material = Enum.Material.SmoothPlastic
                    end
                end
            end
        end
    end
end)

TanqrAimBtn.MouseButton1Click:Connect(function()
    AimEnabled = not AimEnabled
    TanqrAimBtn.Text = AimEnabled and "Tanqr Aim: ON" or "Tanqr Aim: OFF"
    if not AimEnabled then
        restoreParts()
    end
end)

local function addESP(char,plr)
    local head = char:FindFirstChild("Head")
    if not head or head:FindFirstChild("ESPName") then return end
    local b = Instance.new("BillboardGui")
    b.Name = "ESPName"
    b.Adornee = head
    b.Size = UDim2.new(4,0,1,0)
    b.AlwaysOnTop = true
    local t = Instance.new("TextLabel")
    t.Size = UDim2.new(1,0,1,0)
    t.BackgroundTransparency = 1
    t.TextScaled = true
    t.Text = plr.Name
    t.TextColor3 = Color3.fromRGB(255,50,50)
    t.Parent = b
    b.Parent = head
end

local function applyESP(plr)
    if plr == LocalPlayer then return end
    if plr.Character and ESPEnabled then addESP(plr.Character,plr) end
    plr.CharacterAdded:Connect(function(c)
        if ESPEnabled then
            c:WaitForChild("Head",5)
            addESP(c,plr)
        end
    end)
end

for _,p in ipairs(Players:GetPlayers()) do applyESP(p) end
Players.PlayerAdded:Connect(applyESP)

ESPBtn.MouseButton1Click:Connect(function()
    ESPEnabled = not ESPEnabled
    ESPBtn.Text = ESPEnabled and "ESP Name: ON" or "ESP Name: OFF"
    for _,p in ipairs(Players:GetPlayers()) do
        if p.Character then
            local h = p.Character:FindFirstChild("Head")
            if h then
                if ESPEnabled then addESP(p.Character,p) elseif h:FindFirstChild("ESPName") then h.ESPName:Destroy() end
            end
        end
    end
end)

DayNightBtn.MouseButton1Click:Connect(function()
    NightMode = not NightMode
    Lighting.TimeOfDay = NightMode and "00:00:00" or "14:00:00"
    DayNightBtn.Text = NightMode and "Day Mode" or "Night Mode"
end)

CloseMain.MouseButton1Click:Connect(function()
    Main.Visible = false
    Settings.Visible = false
    OpenButton.Visible = true
end)

OpenButton.MouseButton1Click:Connect(function()
    Main.Visible = true
    OpenButton.Visible = false
end)

SettingsBtn.MouseButton1Click:Connect(function()
    Main.Visible = false
    Settings.Visible = true
end)

CloseSettings.MouseButton1Click:Connect(function()
    Settings.Visible = false
    Main.Visible = true
end)

UserInputService.InputBegan:Connect(function(i,p)
    if p then return end
    if i.KeyCode == Enum.KeyCode.RightControl then
        local s = not Main.Visible and not Settings.Visible
        Main.Visible = s
        Settings.Visible = false
        OpenButton.Visible = not s
    end
end)
